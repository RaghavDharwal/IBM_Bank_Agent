# üöÄ Render Deployment Guide - Bank of India Loan Portal

This guide provides complete instructions for deploying the Bank of India Loan Portal to Render with professional production configurations.

## üìã Table of Contents

1. [Overview](#overview)
2. [Prerequisites](#prerequisites)
3. [Backend Deployment](#backend-deployment)
4. [Frontend Deployment](#frontend-deployment)
5. [Environment Configuration](#environment-configuration)
6. [Post-Deployment Setup](#post-deployment-setup)
7. [Monitoring & Maintenance](#monitoring--maintenance)
8. [Troubleshooting](#troubleshooting)

---

## üîç Overview

### Architecture
- **Backend**: Flask API with Gunicorn WSGI server
- **Frontend**: Next.js static site with optimized build
- **Database**: PostgreSQL (managed by Render)
- **Deployment**: Two separate Render services

### Production Features
‚úÖ **Security**: JWT authentication, CORS protection, security headers  
‚úÖ **Performance**: Gunicorn multi-worker setup, optimized builds  
‚úÖ **Reliability**: Health checks, error handling, logging  
‚úÖ **Scalability**: Environment-based configuration, database pooling  
‚úÖ **Monitoring**: Structured logging, health endpoints  

---

## üõ† Prerequisites

1. **Render Account**: [Sign up at render.com](https://render.com)
2. **GitHub Repository**: Code pushed to GitHub
3. **Domain Names** (optional): Custom domains for production

---

## üñ• Backend Deployment

### Step 1: Create Backend Service

1. **Go to Render Dashboard** ‚Üí **New** ‚Üí **Web Service**
2. **Connect Repository**: Select your GitHub repository
3. **Configure Service**:
   ```
   Name: bank-portal-backend
   Region: Oregon (US West) or closest to your users
   Branch: main
   Root Directory: Backend
   Runtime: Python 3
   Build Command: ./build.sh
   Start Command: gunicorn --config gunicorn.conf.py app:app
   ```

### Step 2: Configure Environment Variables

Add these environment variables in Render dashboard:

```bash
# Required - Application Environment
FLASK_ENV=production

# Required - Security Keys (Generate strong random keys)
SECRET_KEY=your-super-secure-secret-key-here-min-32-chars
JWT_SECRET_KEY=your-jwt-secret-key-here-min-32-chars

# Optional - Performance
WEB_CONCURRENCY=4
PORT=5001

# Auto-generated by Render
DATABASE_URL=postgresql://... (Render provides this)
```

### Step 3: Add PostgreSQL Database

1. **In Render Dashboard** ‚Üí **New** ‚Üí **PostgreSQL**
2. **Configure Database**:
   ```
   Name: bank-portal-db
   Database: bank_portal
   User: bank_portal_user
   Region: Same as your backend service
   ```
3. **Connect to Backend**: Copy the database URL to your backend's `DATABASE_URL` environment variable

### Step 4: Deploy Backend

1. **Click Deploy** - First deployment takes 5-10 minutes
2. **Verify Health**: Visit `https://your-backend.onrender.com/health`
3. **Check Logs**: Monitor deployment in Render dashboard

Expected health response:
```json
{
  "status": "healthy",
  "environment": "production",
  "database": "connected"
}
```

---

## üé® Frontend Deployment

### Step 1: Create Static Site Service

1. **Go to Render Dashboard** ‚Üí **New** ‚Üí **Static Site**
2. **Connect Repository**: Select your GitHub repository
3. **Configure Service**:
   ```
   Name: bank-portal-frontend
   Branch: main
   Root Directory: AI-agent-Frontend
   Build Command: ./build.sh
   Publish Directory: out
   ```

### Step 2: Configure Environment Variables

Add these environment variables:

```bash
# Required - Backend URL
NEXT_PUBLIC_API_URL=https://your-backend.onrender.com

# Optional - Branding
NEXT_PUBLIC_APP_NAME=Bank of India Loan Portal
NEXT_PUBLIC_APP_VERSION=1.0.0
```

### Step 3: Deploy Frontend

1. **Click Deploy** - Static builds are typically faster (2-5 minutes)
2. **Verify Deployment**: Visit your frontend URL
3. **Test Integration**: Ensure frontend can communicate with backend

---

## ‚öôÔ∏è Environment Configuration

### Backend Environment Variables

| Variable | Required | Description | Example |
|----------|----------|-------------|---------|
| `FLASK_ENV` | Yes | Application environment | `production` |
| `SECRET_KEY` | Yes | Flask secret key (32+ chars) | `your-secret-key` |
| `JWT_SECRET_KEY` | Yes | JWT signing key (32+ chars) | `your-jwt-key` |
| `DATABASE_URL` | Yes | PostgreSQL connection string | Auto-generated |
| `FRONTEND_URL` | No | Frontend URL for CORS | `https://your-frontend.onrender.com` |
| `WEB_CONCURRENCY` | No | Number of Gunicorn workers | `4` |
| `PORT` | No | Application port | `5001` |

### Frontend Environment Variables

| Variable | Required | Description | Example |
|----------|----------|-------------|---------|
| `NEXT_PUBLIC_API_URL` | Yes | Backend API URL | `https://your-backend.onrender.com` |
| `NEXT_PUBLIC_APP_NAME` | No | Application name | `Bank of India Loan Portal` |
| `NEXT_PUBLIC_APP_VERSION` | No | Version number | `1.0.0` |

---

## üîÑ Post-Deployment Setup

### 1. Create Admin User

Run this script to create your first admin user:

```bash
# SSH into your backend service (if Render provides shell access)
# Or run locally against production database

python -c "
from app import app, db
from models import User
import sys

with app.app_context():
    admin = User(
        full_name='System Administrator',
        email='admin@bankportal.com',
        phone='1234567890',
        aadhaar='123456789012',
        role='admin'
    )
    admin.set_password('SecurePassword123!')
    db.session.add(admin)
    db.session.commit()
    print('Admin user created successfully!')
"
```

### 2. Update CORS Origins

Update your backend's CORS configuration with the actual frontend URL:

```python
# In app.py, update the CORS origins
CORS(app, origins=[
    "https://your-frontend.onrender.com",  # Your actual frontend URL
    "http://localhost:3000",  # Keep for local development
    "http://localhost:3001"
])
```

### 3. Test Full Application

1. **Frontend Access**: Verify the main application loads
2. **User Registration**: Test user registration flow
3. **Admin Login**: Test admin dashboard access
4. **API Integration**: Verify all API endpoints work
5. **Database**: Confirm data persistence

---

## üìä Monitoring & Maintenance

### Health Checks

Monitor these endpoints:

- **Backend**: `https://your-backend.onrender.com/health`
- **Frontend**: Standard HTTP checks

### Logging

- **Backend Logs**: Available in Render dashboard ‚Üí Service ‚Üí Logs
- **Application Logs**: Structured logging to stdout/stderr
- **Database Logs**: Available in PostgreSQL service logs

### Performance Monitoring

Monitor these metrics:
- Response times
- Error rates
- Database connection pool usage
- Memory and CPU usage

### Backup Strategy

1. **Database Backups**: Render provides automatic PostgreSQL backups
2. **Application Code**: Version controlled in GitHub
3. **Configuration**: Document all environment variables

---

## üö® Troubleshooting

### Common Issues

#### Backend Won't Start
```bash
# Check build logs for:
- Missing dependencies in requirements.txt
- Database connection issues
- Environment variable problems

# Solution: Verify all required env vars are set
```

#### Frontend Build Fails
```bash
# Check for:
- TypeScript errors
- ESLint issues
- Missing environment variables

# Solution: Fix errors locally first, then redeploy
```

#### Database Connection Issues
```bash
# Symptoms:
- 500 errors from health check
- "database disconnected" status

# Solutions:
1. Verify DATABASE_URL is correct
2. Check PostgreSQL service status
3. Restart backend service
```

#### CORS Errors
```bash
# Symptoms:
- Frontend can't reach backend
- "Access-Control-Allow-Origin" errors

# Solutions:
1. Update CORS origins in backend
2. Verify NEXT_PUBLIC_API_URL is correct
3. Check environment variable formatting
```

### Debug Commands

```bash
# Check backend health
curl https://your-backend.onrender.com/health

# Check database connection
curl -X POST https://your-backend.onrender.com/api/health

# Test specific endpoints
curl -X GET https://your-backend.onrender.com/api/applications \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

### Performance Tuning

1. **Backend Scaling**:
   - Increase `WEB_CONCURRENCY` for high traffic
   - Monitor database connection pool
   - Consider upgrading Render plan

2. **Database Optimization**:
   - Monitor query performance
   - Add indexes for frequently queried fields
   - Consider connection pooling

3. **Frontend Optimization**:
   - Monitor build size
   - Optimize images and assets
   - Enable CDN caching

---

## ‚úÖ Production Checklist

Before going live:

- [ ] All environment variables configured
- [ ] Database migrations completed
- [ ] Admin user created
- [ ] CORS origins updated with production URLs
- [ ] Health checks returning "healthy"
- [ ] SSL certificates active (automatic with Render)
- [ ] Custom domains configured (if applicable)
- [ ] Error logging functional
- [ ] Backup strategy in place
- [ ] Performance baseline established
- [ ] Security review completed

---

## üîê Security Considerations

1. **Secrets Management**: Never commit secrets to Git
2. **JWT Security**: Use strong, unique keys
3. **Database Security**: Use strong passwords, enable SSL
4. **API Security**: Implement rate limiting if needed
5. **HTTPS**: Always use HTTPS in production (automatic with Render)

---

## üìû Support

For deployment issues:

1. **Check Render Status**: [status.render.com](https://status.render.com)
2. **Render Documentation**: [render.com/docs](https://render.com/docs)
3. **Application Logs**: Use Render dashboard logs
4. **Health Endpoints**: Monitor `/health` endpoint

---

**üéâ Congratulations!** Your Bank of India Loan Portal is now production-ready on Render with enterprise-grade configurations, monitoring, and security features!